
all: DenseToeplitzMPI DenseToeplitzQChem DenseBEMAirbus \
DenseBEMColStateMPI DenseSchur100 DenseSchur500 DenseSchur300 \
test_HSS_mpi_2 DenseBEMColStateMPI_strong

all2: @C_EXAMPLES@ testPoisson2d testPoisson3d	\
	testPoisson2dMPI testPoisson2dMPIDist testMMdouble	\
	testMMdoubleMPI testMMdoubleMPIDist testMMdouble64	\
	testMMdoubleMPIDist64 testMMfloat testMMfloatMPIDist	\
	mtx2bin bin2mtx MLkernel

CC=@MPI_C_COMPILER@
CXX=@MPI_CXX_COMPILER@
CPPFLAGS=-I@CMAKE_INSTALL_PREFIX@/include \
	-I@METIS_INCLUDES@ -I@PARMETIS_INCLUDES@ -I@SCOTCH_INCLUDES@ \
	-I@COMBBLAS_INCLUDES@

CFLAGS=@STRUMPACK_ALL_C_FLAGS@
CXXFLAGS=@STRUMPACK_ALL_CXX_FLAGS@
LIBS=-L@CMAKE_INSTALL_PREFIX@/lib/ -lstrumpack @STRUMPACK_ALL_LIBS@
LDFLAGS=@OpenMP_CXX_FLAGS@ @CMAKE_EXE_LINKER_FLAGS@

INC_COVARIANCE=-I/global/homes/g/gichavez/cori/local/mfem-3.3.2 \
-I/global/homes/g/gichavez/cori/local/hypre-2.10.0b/src/hypre/include \
-I/global/homes/g/gichavez/cori/local/metis-4.0.3
LIB_COVARIANCE=-L/global/homes/g/gichavez/cori/local/mfem-3.3.2 -lmfem \
-L/global/homes/g/gichavez/cori/local/hypre-2.10.0b/src/hypre/lib -lHYPRE \
-L/global/homes/g/gichavez/cori/local/metis-4.0.3 -lmetis
LIB_IPM=-L/global/cscratch1/sd/gichavez/.consulting/INC0117791/IPM/IPM_build_Intel_dynamic/lib -lipm

sexample: sexample.c
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $< -o sexample.o
	$(CXX) $(LDFLAGS) sexample.o -o $@ $(LIBS)
	$(RM) sexample.o
dexample: dexample.c
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $< -o dexample.o
	$(CXX) $(LDFLAGS) dexample.o -o $@ $(LIBS)
	$(RM) dexample.o
cexample: cexample.c
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $< -o cexample.o
	$(CXX) $(LDFLAGS) cexample.o -o $@ $(LIBS)
	$(RM) cexample.o
zexample: zexample.c
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $< -o zexample.o
	$(CXX) $(LDFLAGS) zexample.o -o $@ $(LIBS)
	$(RM) zexample.o

testPoisson2d: testPoisson2d.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testPoisson2d.o
	$(CXX) $(LDFLAGS) testPoisson2d.o -o $@ $(LIBS)
	$(RM) testPoisson2d.o
testPoisson3d: testPoisson3d.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testPoisson3d.o
	$(CXX) $(LDFLAGS) testPoisson3d.o -o $@ $(LIBS)
	$(RM) testPoisson3d.o
testPoisson2dMPI: testPoisson2dMPI.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testPoisson2dMPI.o
	$(CXX) $(LDFLAGS) testPoisson2dMPI.o -o $@ $(LIBS)
	$(RM) testPoisson2dMPI.o

testPoisson2dMPIDist: testPoisson2dMPIDist.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testPoisson2dMPIDist.o
	$(CXX) $(LDFLAGS) testPoisson2dMPIDist.o -o $@ $(LIBS)
	$(RM) testPoisson2dMPIDist.o

testPoisson3dMPIDist: testPoisson3dMPIDist.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testPoisson3dMPIDist.o
	$(CXX) $(LDFLAGS) testPoisson3dMPIDist.o -o $@ $(LIBS)
	$(RM) testPoisson3dMPIDist.o

DenseToeplitzMPI: DenseToeplitzMPI.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o DenseToeplitzMPI.o
	$(CXX) $(LDFLAGS) DenseToeplitzMPI.o -o $@ $(LIBS)
	$(RM) DenseToeplitzMPI.o

DenseToeplitzQChem: DenseToeplitzQChem.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o DenseToeplitzQChem.o
	$(CXX) $(LDFLAGS) DenseToeplitzQChem.o -o $@ $(LIBS)
	$(RM) DenseToeplitzQChem.o

DenseBEMColStateMPI: DenseBEMColStateMPI.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o DenseBEMColStateMPI.o
	$(CXX) $(LDFLAGS) DenseBEMColStateMPI.o -o $@ $(LIBS)
# $(CXX) $(LDFLAGS) DenseBEMColStateMPI.o -o $@ $(LIBS) $(LIB_IPM)
	$(RM) DenseBEMColStateMPI.o

DenseBEMAirbus: DenseBEMAirbus.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o DenseBEMAirbus.o
	$(CXX) $(LDFLAGS) DenseBEMAirbus.o -o $@ $(LIBS)
	$(RM) DenseBEMAirbus.o

DenseSchur100: DenseSchur100.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o DenseSchur100.o
	$(CXX) $(LDFLAGS) DenseSchur100.o -o $@ $(LIBS)
	$(RM) DenseSchur100.o

DenseSchur300: DenseSchur300.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o DenseSchur300.o
	$(CXX) $(LDFLAGS) DenseSchur300.o -o $@ $(LIBS)
	$(RM) DenseSchur300.o

DenseSchur500: DenseSchur500.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o DenseSchur500.o
	$(CXX) $(LDFLAGS) DenseSchur500.o -o $@ $(LIBS)
	$(RM) DenseSchur500.o

test_HSS_mpi_2: test_HSS_mpi_2.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o test_HSS_mpi_2.o
	$(CXX) $(LDFLAGS) test_HSS_mpi_2.o -o $@ $(LIBS)
	$(RM) test_HSS_mpi_2.o

DenseBEMColStateMPI_strong: DenseBEMColStateMPI_strong.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o DenseBEMColStateMPI_strong.o
	$(CXX) $(LDFLAGS) DenseBEMColStateMPI_strong.o -o $@ $(LIBS)
	$(RM) DenseBEMColStateMPI_strong.o

DenseCovariance: DenseCovariance.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $(INC_COVARIANCE) -c $< -o DenseCovariance.o
	$(CXX) $(LDFLAGS) DenseCovariance.o -o $@ $(LIBS) $(LIB_COVARIANCE)
	$(RM) DenseCovariance.o

testMMdouble: testMMdouble.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testMMdouble.o
	$(CXX) $(LDFLAGS) testMMdouble.o -o $@ $(LIBS)
	$(RM) testMMdouble.o

testMMdoubleMPI: testMMdoubleMPI.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testMMdoubleMPI.o
	$(CXX) $(LDFLAGS) testMMdoubleMPI.o -o $@ $(LIBS)
	$(RM) testMMdoubleMPI.o

testMMdoubleMPIDist: testMMdoubleMPIDist.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testMMdoubleMPIDist.o
	$(CXX) $(LDFLAGS) testMMdoubleMPIDist.o -o $@ $(LIBS)
	$(RM) testMMdoubleMPIDist.o

testMMdouble64: testMMdouble64.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testMMdouble64.o
	$(CXX) $(LDFLAGS) testMMdouble64.o -o $@ $(LIBS)
	$(RM) testMMdouble64.o

testMMdoubleMPIDist64: testMMdoubleMPIDist64.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testMMdoubleMPIDist64.o
	$(CXX) $(LDFLAGS) testMMdoubleMPIDist64.o -o $@ $(LIBS)
	$(RM) testMMdoubleMPIDist64.o

testMMfloat: testMMfloat.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testMMfloat.o
	$(CXX) $(LDFLAGS) testMMfloat.o -o $@ $(LIBS)
	$(RM) testMMfloat.o

testMMfloatMPIDist: testMMfloatMPIDist.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o testMMfloatMPIDist.o
	$(CXX) $(LDFLAGS) testMMfloatMPIDist.o -o $@ $(LIBS)
	$(RM) testMMfloatMPIDist.o

mtx2bin: mtx2bin.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o mtx2bin.o
	$(CXX) $(LDFLAGS) mtx2bin.o -o $@ $(LIBS)
	$(RM) mtx2bin.o

bin2mtx: bin2mtx.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o bin2mtx.o
	$(CXX) $(LDFLAGS) bin2mtx.o -o $@ $(LIBS)
	$(RM) bin2mtx.o

MLkernel: MLkernel.cpp
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $< -o MLkernel.o
	$(CXX) $(LDFLAGS) MLkernel.o -o $@ $(LIBS)
	$(RM) MLkernel.o

clean:
	rm -f *~ *o @C_EXAMPLES@ testPoisson2d	\
	testPoisson3d testPoisson2dMPI testPoisson2dMPIDist	\
	testMMdouble testMMdoubleMPI testMMdoubleMPIDist	\
	testMMdouble64 testMMdoubleMPIDist64			\
	testMMfloat testMMfloatMPIDist				\
	mtx2bin bin2mtx MLkernel \
	testPoisson3dMPIDist DenseToeplitzMPI \
	DenseToeplitzQChem DenseBEMColStateMPI \
	DenseBEMAirbus DenseSchur100 DenseCovariance \
	DenseSchur500 DenseSchur300 test_HSS_mpi_2 \
	DenseBEMColStateMPI_strong
